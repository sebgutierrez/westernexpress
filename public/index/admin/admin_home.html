<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/admin/admin.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=DM Sans">
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300&family=Poppins:wght@200&display=swap"
      rel="stylesheet"
    />
    <title>Admin Home</title>
  </head>
  <body>
    <div class="transparent-background"></div>

    <header class="admin-portal-header">
      <h1><strong>Admin Portal</strong></h1>
    </header>

    <div class="container">
      <nav class="side-nav">
        <ul>
          <li>
            <a href="#" onclick="loadContent('dashboard')"
              >Dashboard Overview</a
            >
          </li>
          <li>
            <a href="#" onclick="loadContent('salary')">Salary Report</a>
          </li>
          <li>
            <a href="#" onclick="loadContent('reports')">Sales Report</a>
          </li>
          <li><a href=""onclick="loadContent('addemployee')">Add Employee</a></li>
          <li><a href="#" onclick="signOut()">Sign Out</a></li>
          <script>
            function signOut() {
                // Perform logout logic here, e.g., clearing session storage, etc.
        
                // Redirect to index.html after logout
                window.location.href = "/index.html";
            }
          </script>
        </ul>
      </nav>
      <main class="content">
        <div id="dashboard">
          <h1>Western Express: Administration Portal</h1>
          <div class="dashboard-info">
            <div class="dashboard-card">
              <h2>Today's Packages</h2>
              <p>Total: 50</p>
              <p>Delivered: 35</p>
              <p>Out for Delivery: 10</p>
              <p>In Transit: 5</p>
            </div>
            <div class="dashboard-card">
              <h2>Employee Stats</h2>
              <p>Total Employees: 100</p>
              <p>Active: 80</p>
              <p>Inactive: 20</p>
            </div>
            <div class="dashboard-card">
              <h2>Recent Shipments</h2>
              <ul>
                <li>Shipment 1234 - Delivered</li>
                <li>Shipment 5678 - In Transit</li>
                <li>Shipment 9012 - Delivered</li>
                <li>Shipment 3456 - Out for Delivery</li>
              </ul>
            </div>
          </div>
        </div>

        <div id="employee">
          <div id="employeeManagement">
            <h2>Employee Management</h2>
            <div id="employeeTable"></div>
          </div>
        </div>

        <div id="salary">
          <h2>Salary Report</h2>
          <form id="salaryReportForm">
            <div class="container1">
              <label for="employeeId">Employee ID</label>
              <input type="number" id="employeeId" name="employeeId" required />
            </div>

            <div class="container2">
              <label for="amount">Salary Amount</label>
              <div>
                <select id="amountComparison" name="amountComparison" required>
                  <option value="">Select an Option</option>
                  <option value=">">Greater Than</option>
                  <option value="<">Less Than</option>
                  <option value="=">Equal To</option>
                </select>
                <input type="number" id="amount" name="amount" required />
              </div>
            </div>

            <div class="container3">
              <label for="role">Role</label>
              <select id="role" name="role" required>
                <option value="">Select a Role</option>
                <option value="1">Clerk</option>
                <option value="2">Driver</option>
                <option value="3">Manager</option>
                <option value="4">District Manager</option>
                <option value="5">Supervisor</option>
                <option value="6">Support</option>
                <option value="7">CEO</option>
              </select>
            </div>

            <div class="container4">
              <label for="location">Location</label>
              <select id="location" name="location">
                <option value="">Select a Location</option>
                <option value="150">4516 Burleson Rd, Austin, TX 78744</option>
                <option value="151">
                  3740 Greenbriar Dr, Houston, TX 77098
                </option>
                <option value="152">515 Centre St, Dallas, TX 75208</option>
                <option value="153">219 E Mills Ave, El Paso, TX 79901</option>
                <option value="154">5001 Avenue L, Lubbock, TX 79452</option>
                <option value="155">3903 Melear Dr, Arlington, TX 76015</option>
                <option value="156">
                  1140 S Laredo St, San Antonio, TX 78204
                </option>
                <option value="157">
                  5200 W University Blvd, Odessa, TX 79764
                </option>
                <option value="158">
                  10515 Stonewall Blvd, Corpus Christi, TX 78410
                </option>
                <option value="159">423 Los Alamos Dr, Alamo, TX 78516</option>
              </select>
            </div>

            <div class="container5">
              <button type="button" onclick="generateSalaryReport()">
                Generate Report
              </button>
            </div>
          </form>

          <div id="salaryResult">
            <h3>Generated Salary Report:</h3>
            <ul id="salaryList"></ul>
          </div>
        </div>

        <div id="reports">
          <div class="sales">
            <h2>Sales Report Generator</h2>
            <form id="salesreport">
              <div class="container1">
                <label for="amountSales">Amount</label>
                <div>
                  <select id="amountComparisonSales" name="amountComparison">
                    <option value="=">Equal to</option>
                    <option value=">">Greater than</option>
                    <option value="<">Less than</option>
                  </select>
                  <input type="number" id="amountSales" name="amount" />
                </div>
              </div>

              <div class="container2">
                <label for="locationSales">Location</label>
                <select id="locationSales" name="location">
                  <option value="">Select a location</option>
                  <option value="150">
                    4516 Burleson Rd, Austin, TX 78744
                  </option>
                  <option value="151">
                    3740 Greenbriar Dr, Houston, TX 77098
                  </option>
                  <option value="152">515 Centre St, Dallas, TX 75208</option>
                  <option value="153">
                    219 E Mills Ave, El Paso, TX 79901
                  </option>
                  <option value="154">5001 Avenue L, Lubbock, TX 79452</option>
                  <option value="155">
                    3903 Melear Dr, Arlington, TX 76015
                  </option>
                  <option value="156">
                    1140 S Laredo St, San Antonio, TX 78204
                  </option>
                  <option value="157">
                    5200 W University Blvd, Odessa, TX 79764
                  </option>
                  <option value="158">
                    10515 Stonewall Blvd, Corpus Christi, TX 78410
                  </option>
                  <option value="159">
                    423 Los Alamos Dr, Alamo, TX 78516
                  </option>
                </select>
              </div>

              <div class="container3">
                <label for="dateSales">Date</label>
                <select id="dateComparisonSales" name="dateComparison">
                  <option value="=">On</option>
                  <option value="<">Before</option>
                  <option value=">">After</option>
                </select>
                <input type="date" id="dateSales" />
              </div>

              <div class="container4">
                <label for="employeeIdSales">Employee ID</label>
                <input type="number" id="employeeIdSales" name="employeeId" />
              </div>

              <div class="container5">
                <button type="button" onclick="generateReport()">
                  Generate Report
                </button>
              </div>
            </form>

            <div id="result">
              <h3>Generated Report:</h3>
              <ul id="reportList"></ul>
            </div>
          </div>
        </div>

        <div id="addemployee">
          <h1>Create employee acount</h1>

          <form id="empsignupForm" action="/employee/signup" method="POST">
            <input type="text" name="firstname" placeholder="Firstname" required><br><br>
            <input type="text" name="lastname" placeholder="Lastname" required><br><br>
            <input type="text" name="username" placeholder="Username" required><br><br>
            <input type="password" name="password" placeholder="Password" required><br><br>
    
            <div class="input-box">
                <span class="details"></span>
                <input type="text" name="phoneNumber" placeholder="Enter your number" required>
            </div>
    
            <div class="input-box">
                <span class="details"></span>
                <input type="email" name="email" placeholder="Enter your email" required>
            </div>
    
            <div class="input-box">
                <span class="details"></span>
                <input type="text" name="address" placeholder="Enter your address" required>
            </div>
    
            <div class="input-box">
                <span class="details"></span>
                <div id="cityInputContainer">
                  <select name="city" required>
                    <option value="" disabled selected>Select City</option>
                    <option value="Austin">Austin</option>
                    <option value="Houston">Houston</option>
                    <option value="Dallas">Dallas</option>
                    <option value="El Paso">El Paso</option>
                    <option value="Lubbock">Lubbock</option>
                    <option value="Arlington">Arlington</option>
                    <option value="San Antonio">San Antonio</option>
                    <option value="Odessa">Odessa</option>
                    <option value="Corpus Christi">Corpus Christi</option>
                    <option value="Alamo">Alamo</option>
                  </select>
                </div>
            </div>
    
            <div class="input-box">
                <span class="details"></span>
                <div id="stateInputContainer">
                  <select name="state" required>
                    <option value="" disabled selected>Enter your state</option>
                    <option value="AL">Alabama</option>
                    <option value="AK">Alaska</option>
                    <option value="AZ">Arizona</option>
                    <option value="AR">Arkansas</option>
                    <option value="CA">California</option>
                    <option value="CO">Colorado</option>
                    <option value="CT">Connecticut</option>
                    <option value="DE">Delaware</option>
                    <option value="FL">Florida</option>
                    <option value="GA">Georgia</option>
                    <option value="HI">Hawaii</option>
                    <option value="ID">Idaho</option>
                    <option value="IL">Illinois</option>
                    <option value="IN">Indiana</option>
                    <option value="IA">Iowa</option>
                    <option value="KS">Kansas</option>
                    <option value="KY">Kentucky</option>
                    <option value="LA">Louisiana</option>
                    <option value="ME">Maine</option>
                    <option value="MD">Maryland</option>
                    <option value="MA">Massachusetts</option>
                    <option value="MI">Michigan</option>
                    <option value="MN">Minnesota</option>
                    <option value="MS">Mississippi</option>
                    <option value="MO">Missouri</option>
                    <option value="MT">Montana</option>
                    <option value="NE">Nebraska</option>
                    <option value="NV">Nevada</option>
                    <option value="NH">New Hampshire</option>
                    <option value="NJ">New Jersey</option>
                    <option value="NM">New Mexico</option>
                    <option value="NY">New York</option>
                    <option value="NC">North Carolina</option>
                    <option value="ND">North Dakota</option>
                    <option value="OH">Ohio</option>
                    <option value="OK">Oklahoma</option>
                    <option value="OR">Oregon</option>
                    <option value="PA">Pennsylvania</option>
                    <option value="RI">Rhode Island</option>
                    <option value="SC">South Carolina</option>
                    <option value="SD">South Dakota</option>
                    <option value="TN">Tennessee</option>
                    <option value="TX">Texas</option>
                    <option value="UT">Utah</option>
                    <option value="VT">Vermont</option>
                    <option value="VA">Virginia</option>
                    <option value="WA">Washington</option>
                    <option value="WV">West Virginia</option>
                    <option value="WI">Wisconsin</option>
                    <option value="WY">Wyoming</option>
                  </select>
                </div>
                  
                
            </div>
    
            <div class="input-box">
                <span class="details"></span>
                <input type="number" name="zipcode" placeholder="Enter your zipcode" required>
            </div>

            <div class="input-box">
              <span class="details"></span>
              <select name="postOfficeLocation" required>
                  <option value="" disabled selected>Select Post Office Location</option>
                  <option value="150">4516 Burleson Rd, Austin, TX 78744</option>
                  <option value="151">3740 Greenbriar Dr, Houston, TX 77098</option>
                  <option value="152">515 Centre St, Dallas, TX 75208</option>
                  <option value="153">219 E Mills Ave, El Paso, TX 79901</option>
                  <option value="154">5001 Avenue L, Lubbock, TX 79452</option>
                  <option value="155">3903 Melear Dr, Arlington, TX 76015</option>
                  <option value="156">1140 S Laredo St, San Antonio, TX 78204</option>
                  <option value="157">5200 W University Blvd, Odessa, TX 79764</option>
                  <option value="158">10515 Stonewall Blvd, Corpus Christi, TX 78410</option>
                  <option value="159">423 Los Alamos Dr, Alamo, TX 78516</option>
              </select>
          </div>

          <br><br>
        <input type="submit" value="Signup">
    </form>


        </div>
      </main>
    </div>
    <script>
      const links = document.querySelectorAll(".side-nav a");

      links.forEach((link) => {
        link.addEventListener("click", (event) => {
          event.preventDefault(); // Prevent the default link behavior (optional)

          // Remove the "clicked" class from all links
          links.forEach((otherLink) => {
            otherLink.classList.remove("clicked");
          });

          // Add the "clicked" class to the clicked link
          link.classList.add("clicked");
        });
      });

      function loadContent(contentId) {
        // Hide all content divs
        const contentDivs = document.querySelectorAll(".content > div");
        contentDivs.forEach((div) => {
          div.style.display = "none";
        });

        // Show the selected content
        document.getElementById(contentId).style.display = "block";
      }
      // Set the "Home" link to be lit up by default
      const homeLink = document.querySelector(".side-nav a[href='#']");
      homeLink.classList.add("clicked");
      loadContent("dashboard");


      /***************************************** REPORTS PAGE **********************************************************/
      /* will send the POST Request once generate report button is clicked based off of user input SQL query based on user input  */

      /***************************************** URL *************************************************************************/

      const BASE_URL = "https://westernexpresspostal.azurewebsites.net";
      //const BASE_URL = "http://localhost:5500";
      if (typeof require !== "undefined") {
        const path = require("path");
        require("dotenv").config({
          path: path.resolve(__dirname, "../../../.env"),
        });
      }

      /***************************************** SALES REPORTS PAGE **********************************************************/

      function generateReport() {
        const amount = document.getElementById("amountSales").value;
        const amountComparison = document.getElementById(
          "amountComparisonSales"
        ).value;
        const location = document.getElementById("locationSales").value;
        const date = document.getElementById("dateSales").value || null;
        const dateComparison = document.getElementById(
          "dateComparisonSales"
        ).value;
        const employeeId = document.getElementById("employeeIdSales").value;

        const requestData = {};

        // Add non-empty attributes to the requestData object
        if (amount.trim() !== "") {
          requestData.amount = amount;
          requestData.amountComparison = amountComparison;
        }
        if (location.trim() !== "") {
          requestData.location = location;
        }
        if (date !== null) {
          requestData.date = date;
          requestData.dateComparison = dateComparison;
        }
        if (employeeId.trim() !== "") {
          requestData.employeeId = employeeId;
        }

        console.log(requestData);

        // Sending a POST request if there is data to send
        if (Object.keys(requestData).length > 0) {
          fetch(`${BASE_URL}/generateReport`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(requestData),
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
              }
              return response.json();
            })
            .then((data) => {
              displayReport(data);
            })
            .catch((error) => {
              console.error(error);
            });
        } else {
          console.log("No data to send");
        }
      }

      function displayReport(data) {
        const reportList = document.getElementById("reportList");
        reportList.innerHTML = "";

        if (Array.isArray(data)) {
          data.forEach((item) => {
            const listItem = document.createElement("li");
            const formattedDate = item.sale_date
              ? new Date(item.sale_date).toISOString().split("T")[0]
              : "Invalid Date";

            listItem.textContent = `Amount: ${item.amount}, Date: ${formattedDate}, Employee ID: ${item.emp_id}, Employee Name: ${item.first_name} ${item.last_name}`;
            reportList.appendChild(listItem);
            //console.log($formattedDate); ////////////////////////////////////////////////////////////////////////////////////////////////
          });
          //console.log($formattedDate);
        } else if (typeof data === "object" && data !== null) {
          const listItem = document.createElement("li");
          const formattedDate = data.sale_date
            ? new Date(data.sale_date).toISOString().split("T")[0]
            : "Invalid Date";

          listItem.textContent = `Amount: ${data.amount}, Date: ${formattedDate}, Employee ID: ${data.emp_id}, Employee Name: ${data.first_name} ${data.last_name}`;
          reportList.appendChild(listItem);
        } else {
          const listItem = document.createElement("li");
          listItem.textContent = "Invalid data format";
          reportList.appendChild(listItem);
        }

        const resultContainer = document.getElementById("result");
        resultContainer.style.display = "block";
      }

      /***************************************** SALARY REPORTS PAGE **********************************************************/
      function generateSalaryReport() {
        // Retrieving input values from the HTML form
        const employeeId = document.getElementById("employeeId").value;
        const amountComparison =
          document.getElementById("amountComparison").value;
        const amount = document.getElementById("amount").value;
        const role = document.getElementById("role").value;
        const location = document.getElementById("location").value;

        // Creating an empty object to hold salary report parameters
        const reportParams = {};

        // Add non-empty attributes to the reportParams object
        if (employeeId.trim() !== "") {
          reportParams.employeeId = employeeId;
        }
        if (amount.trim() !== "") {
          reportParams.amount = amount;
          reportParams.amountComparison = amountComparison;
        }
        if (role.trim() !== "") {
          reportParams.role = role;
        }
        if (location.trim() !== "") {
          reportParams.location = location;
        }

        console.log(reportParams);

        // Sending a POST request if there is data to send
        if (Object.keys(reportParams).length > 0) {
          fetch(`${BASE_URL}/generateSalaryReport`, {
            headers: {
              "Content-type": "application/json; charset=utf-8",
            },
            method: "POST",
            body: JSON.stringify(reportParams),
          })
            .then((response) => response.json())
            .then((data) => {
              console.log(data);
              // Checking and formatting received data for table display
              if (
                Array.isArray(data) &&
                data.length > 0 &&
                typeof data[0] === "object"
              ) {
                displaySalaryReport(data, "salaryList");
              } else {
                alert("Invalid data format or empty");
              }
            })
            .catch((error) => console.error("Fetch error:", error));
        } else {
          console.log("No data to send");
        }

        // Function to create an HTML list from fetched salary report data
        function displaySalaryReport(data, elementToBind) {
          if (
            !Array.isArray(data) ||
            data.length === 0 ||
            typeof data[0] !== "object"
          ) {
            console.error("Invalid data format or empty");
            return;
          }

          // Creating the HTML list structure
          var ul = document.createElement("ul");

          // Populating the list with data
          for (var i = 0; i < data.length; i++) {
            var li = document.createElement("li");
            li.innerHTML = formatSalaryListItem(data[i]);
            ul.appendChild(li);
          }

          // Displaying the list in the specified HTML element
          var divContainer = document.getElementById(elementToBind);
          divContainer.innerHTML = "";
          divContainer.appendChild(ul);
        }

        // Function to format a salary report item for display
        function formatSalaryListItem(item) {
          // Customize the formatting based on your data structure
          return `${item.emp_id} ${item.first_name} ${item.last_name} - ${item.role_name}: Salary: ${item.salary}, Hours: ${item.total_hours}`;
        }
      }
    </script>
  </body>
</html>

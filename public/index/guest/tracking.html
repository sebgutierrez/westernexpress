<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Postal Service Business Name</title>
    <link rel="stylesheet" href="/css/guest/tracking.css"> <!-- Link to your homepage CSS file -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=DM Sans">
	<style>
		table {
		  border-collapse: collapse;
		  width: 100%;
		  padding: 2rem;
		}
		table, th, td {
		  border: 1px solid black;
		}
		th, td {
		  padding: 10px;
		  text-align: left;
		}
	</style>
</head>
<body>
    <header class="header">
        <h1 class="website-name"><a class="website-homepage-link" href="/index.html">Western Express</a></h1>
        <nav class="navbar">
            <ul class="navlist">
				<li class="navlist-item"><a class="navlist-link" href="/index/guest/services.html">Shipping</a></li>
				<li class="navlist-item"><a class="navlist-link" href="/index/guest/tracking.html">Tracking</a></li>
                <li class="navlist-item"><a class="navlist-link" href="/index/guest/locations.html">Locations</a></li>                     
                <li class="navlist-item"><a class="navlist-link" href="/index/guest/customer_support.html">Support</a></li>                                  
            </ul>
        </nav>
        <div class="account-buttons">
            <button class="sign-in-button"><a class="sign-in-link" href="/index/sign_in.html">Log In</a></button>                  
            <button class="sign-up-button"><a class="sign-up-link" href="/index/sign_up.html">Sign Up</a></button>
        </div>
    </header>
	<section class="tracking-section">
		<span class="section-header">Western Express Tracking</span>
		<div class="track-box" id="track-box" style="display: flex;">
			<form class="tracking-search-form" id="tracking-search-form">
				<label for="tracking-input" class="tracking-label"></label>
				<input type="text" name="tracking-input" id="tracking-input" class="tracking-input" placeholder="Enter a 12-digit tracking number" required />
				<button id="tracking-submit" onClick="formSubmission()" class="tracking-search-button">Search</button>
			</form>
		</div>
		<!--<div class="progress-bar-div">
			<ol class="progress-bar">
				<li class="status-node">
					<span class="status-node-desc">Processing</span>
				</li>
				<li class="status-node">
					<span class="status-node-desc">Shipped</span>
				</li>
				<li class="status-node">
					<span class="status-node-desc">In Transit</span>
				</li>
				<li class="status-node">
					<span class="status-node-desc">Out for Delivery</span>
				</li>
				<li class="status-node">
					<span class="status-node-desc">Delivered</span>
				</li>
			</ol>
		</div>-->
		<div class="tracking-info-container" id="tracking-info-container">
			<div class="tracking-status-container">
				<!--<span class="latest-tracking-status">IN TRANSIT</span>-->
				<span class="tracking-id-container">Tracking ID:
					<span class="tracking-id" id="tracking-id"></span>
				</span>
				<!--<div class="latest-checkpoint-container">
					<div class="latest-checkpoint-desc-container">
						<span class="latest-checkpoint-desc-header">Latest Checkpoint</span>
						<span class="latest-checkpoint-desc">
							Arriving at Post Office in 
							<span class="latest-checkpoint-address">Dallas, TX 77649</span>
						</span>
					</div>
					<div class="latest-checkpoint-datetime-container">
						<span class="latest-checkpoint-datetime-header">Date</span>
						<span class="latest-checkpoint-datetime">
							<span class="latest-checkpoint-date">October 29, 2023</span>
							at
							<span class="latest-checkpoint-time">10:51 am</span>
						</span>
					</div>
				</div>-->
			</div>
			<div class="tracking-info-table-container" style="margin-bottom: 2rem;">
				<div class="tracking-information-container">
					<span class="information-tab-name">Tracking History</span>
					<label for="tracking-checkbox" class="dropdown">
						<input type="checkbox" name="tracking-checkbox" id="tracking-checkbox" class="tracking-checkbox">
						<svg class="dropdown-down-svg" width="50px" height="50px" viewBox="0 -2 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd" clip-rule="evenodd" d="M6.29289 8.29289C6.68342 7.90237 7.31658 7.90237 7.70711 8.29289L12 12.5858L16.2929 8.29289C16.6834 7.90237 17.3166 7.90237 17.7071 8.29289C18.0976 8.68342 18.0976 9.31658 17.7071 9.70711L12.7071 14.7071C12.3166 15.0976 11.6834 15.0976 11.2929 14.7071L6.29289 9.70711C5.90237 9.31658 5.90237 8.68342 6.29289 8.29289Z" fill="#081B4B"/>
						</svg>
						<svg class="dropdown-up-svg" width="50px" height="50px" viewBox="0 -2 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd" clip-rule="evenodd" d="M11.2929 8.29289C11.6834 7.90237 12.3166 7.90237 12.7071 8.29289L17.7071 13.2929C18.0976 13.6834 18.0976 14.3166 17.7071 14.7071C17.3166 15.0976 16.6834 15.0976 16.2929 14.7071L12 10.4142L7.70711 14.7071C7.31658 15.0976 6.68342 15.0976 6.29289 14.7071C5.90237 14.3166 5.90237 13.6834 6.29289 13.2929L11.2929 8.29289Z" fill="#081B4B"/>
						</svg>
					</label>
				</div>
				<div id="tracking-table"></div>
			</div>
		</div>
		</div>
	</section>
	<script>
		
		const BASE_URL = 'http://localhost:5500';
		//const BASE_URL = 'https://westernexpresspostal.azurewebsites.net';
		const track_box = document.getElementById('track-box')
		const search_form = document.getElementById('tracking-search-form')
		const tracking_info = document.getElementById('tracking-info-container')

		search_form.onsubmit = (event) => {
			event.preventDefault()

			// switch display 
			if(track_box.style.display === 'flex'){
				track_box.style.display = 'none'
				tracking_info.style.display = 'flex'
			}
			else{
				track_box.style.display = 'flex'
				tracking_info.style.display = 'none'
			}	
		};
	
		function formSubmission(){

			let tracking_id = document.getElementById('tracking-input').value
			const tracking_id_span = document.getElementById('tracking-id');
			tracking_id_span.innerHTML = tracking_id;

			fetch(`${BASE_URL}/track/history/${tracking_id}`)
				.then(response => response.json())
				.then(data => {
					if(typeof data.alert === 'undefined'){
						JSONToHTMLTable(data[0], "tracking-table");
					}
					else{
						alert('The tracking ID you sent does not exist!'); 
					}
				})
				.catch(error => (console.error('Fetch error:', error)));
		}

		function JSONToHTMLTable(data, elementToBind) {           
			var col = [];
			for (var i = 0; i < data.length; i++) {
				for (var key in data[i]) {
					if (col.indexOf(key) === -1) {
						col.push(key);
					}
				}
			}

			//This Code creates HTML table
			var table = document.createElement("table");

			//This Code getsrows for header creader above.
			var tr = table.insertRow(-1);

			for (var i = 0; i < col.length; i++) {
				var th = document.createElement("th");
				th.innerHTML = col[i];
				tr.appendChild(th);
			}

			//This Code adds data to table as rows
			for (var i = 0; i < data.length; i++) {

				tr = table.insertRow(-1);

				for (var j = 0; j < col.length; j++) {
					var tabCell = tr.insertCell(-1);
					tabCell.innerHTML = data[i][col[j]];
				}
			}

			//This Code gets the all columns for header
			var divContainer = document.getElementById(elementToBind);
			divContainer.appendChild(table);
		}
	</script>
</body>
</html>
